<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo de Regalos</title>

<style>
  body {
    margin:0;
    padding:0;
    font-family: 'Segoe UI', sans-serif;
    background: #fafafa;
  }

  header {
    padding: 25px;
    text-align: center;
    background: #ffffff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  h1 {
    margin:0;
    font-size: 32px;
    font-weight: 700;
    color: #333;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px,1fr));
    gap: 25px;
    padding: 30px;
  }

  .card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    overflow: hidden;
    transition: transform .3s ease;
    cursor: pointer;
    border: 3px solid transparent;
  }

  .card:hover {
    transform: translateY(-6px);
  }

  .card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: #eee;
  }

  .card-content {
    padding: 16px;
  }

  .card h3 {
    margin: 0 0 6px 0;
    font-size: 20px;
  }

  .card p {
    margin: 0 0 10px 0;
    color: #555;
  }

  .agotado {
    opacity: 0.45 !important;
    pointer-events: none;
  }

  #confirm-btn {
    display: block;
    margin: 30px auto;
    padding: 12px 28px;
    background: #0077ff;
    color: white;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
    border: none;
  }

  #confirm-btn:disabled {
    background:#bbb;
    cursor:not-allowed;
  }
</style>
</head>

<body>

<header>
  <h1>Elegí un regalo</h1>
</header>

<div class="grid" id="grid"></div>

<button id="confirm-btn" disabled>Confirmar Selección</button>

<script>
  const API = "https://script.google.com/macros/s/AKfycby7tm3mzzCbNbYQXcwxxv8cK9nuahTTbuDvy-elbyihaURbbZerQGpyj9tEvnVpnxkY/exec";

  let seleccion = [];

  async function cargar() {
    const res = await fetch(API);
    const items = await res.json();

    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    items.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";
      if (item.stockRestante <= 0) card.classList.add("agotado");

      card.innerHTML = `
        <img src="${item.imagen}">
        <div class="card-content">
          <h3>${item.nombre}</h3>
          <p>${item.descripcion}</p>
          <span style="font-size:14px;color:#0077ff;">Stock disponible: ${item.stockRestante}</span>
        </div>
      `;

      card.onclick = () => toggle(item.id, card);
      grid.appendChild(card);
    });
  }

  function toggle(id, card) {
    if (seleccion.includes(id)) {
      seleccion = seleccion.filter(x => x !== id);
      card.style.border = "3px solid transparent";
    } else {
      seleccion.push(id);
      card.style.border = "3px solid #0077ff";
    }

    document.getElementById("confirm-btn").disabled = seleccion.length === 0;
  }

  document.getElementById("confirm-btn").onclick = async () => {
    const nombre = prompt("Tu nombre completo:");
    if (!nombre) return;

    const email = prompt("Tu email:");
    if (!email) return;

    const respuesta = await fetch(API, {
      method: "POST",
      body: JSON.stringify({
        nombre,
        email,
        seleccion
      })
    });

    const r = await respuesta.json();

    if (r.success) {
      alert("¡Gracias! Tu selección fue guardada.");
      seleccion = [];
      cargar();
    } else {
      alert("Error: " + r.error);
    }
  };

  cargar();
</script>

</body>
</html>
